!function(t){function e(){var e=function(){for(var t={},e=window.location.search.substring(1),i=e.split("&"),s=0;s<i.length;s++){var r=i[s].split("=");if("undefined"==typeof t[r[0]])t[r[0]]=r[1];else if("string"==typeof t[r[0]]){var n=[t[r[0]],r[1]];t[r[0]]=n}else t[r[0]].push(r[1])}return t}();if(void 0!==e.filter){var i=t(".filter-option[data-filter="+e.filter+"]");return oldDropWidth=i.outerWidth(),i}}function i(){t(".alert-message").fadeOut("fast",function(){t(this).remove()});var e="",i=t(".in-bucket"),s=i.length;return s>0?t.each(i,function(i){0!==i&&s>1&&(e+=i!==s-1?", ":" and "),e+="<strong>"+t(this).parent().attr("data-filter-label")+"</strong>"}):e="<strong>ALL</strong>","Showing "+e+" results."}function s(){newWindowWidth=t(window).width(),t(".in-bucket").length>0&&(newDropWidth=t(".in-bucket:first-of-type").outerWidth()),a.newParentPos=t(".filter-option-slot:first-of-type").offset().left}function r(e,i){for(var s=0,r=e.length;r>s;s++)if(-1===t.inArray(e[s],i))return!1;return!0}var n,a;t.DragDropFilter=function(e,i,s){var r={optionsContainer:t("#filter-options"),bucketInstructions:"",filterGroup:"categories",gutterWidth:20,wideWidth:1056,narrowWidth:720,alertSec:2e3};a=this,this.resultsList=e,i&&"undefined"!=typeof i?this.rebuildResultsPre=i:this.rebuildResultsPre=function(t){t()},this.settings=t.extend({},r,s)},t.DragDropFilter.prototype.init=function(i){for(var r=0,n=i.length;n>r;r++)this.settings.optionsContainer.append('<div class="filter-option-slot out drop-spot '+i[r].toLowerCase()+'" data-filter-label="'+i[r].toLowerCase()+'"><div class="filter-option draggable" data-filter="'+i[r].toLowerCase()+'"><span class="icon '+i[r].toLowerCase()+'">'+i[r]+"</span></div><span>"+i[r]+"</span></div>");var o='<div id="filter-bucket" class="sort-bucket drop-spot in empty">';this.settings.bucketInstructions&&(o+='<span class="bucket-instr">'+this.settings.bucketInstructions+"</span>"),o+='<a href="#" class="clear-all">Clear All Filters</a>',o+="</div>",this.settings.optionsContainer.after(o),this.bucket=t("#filter-bucket"),this.bucketHeightStart=this.bucket.height(),this.bucketOrder=[];var l=e();l&&this.dropInBucket(l),t(".draggable").draggable({cursor:"move",stack:".draggable",revert:function(e,i){var s;return t(this).hasClass("reverting")&&(t(this).data("uiDraggable").originalPosition={top:0,left:0},0===t(".in-bucket").length&&(s="last-out"),a.update("out",s,t(this)),t(this).removeClass("reverting")),!e},start:function(t,e){a.curIconStartPos=e.helper.position()}}),this.bucket.droppable({tolerance:"touch",accept:function(e){if(!t(this).hasClass("out"))return!0;var i=t(this).attr("data-filter-label");return e.attr("data-filter")===i?!0:void 0},over:function(e,i){t(this).addClass("over"),i.helper.hasClass("reverting")&&i.helper.addClass("in-bucket").removeClass("reverting")},drop:function(t,e){a.dropInBucket(e.draggable)},out:function(e,i){t(this).removeClass("over"),i.helper.hasClass("in-bucket")&&i.helper.removeClass("in-bucket").addClass("reverting")}});var h={width:0,init:function(){oldWindowWidth=t(window).width()},checkResize:function(t){this.width!==oldWindowWidth&&t.apply()}};h.init();var d=!1,u=300;t(window).resize(function(){h.checkResize(function(){s(),d!==!1&&clearTimeout(d),d=setTimeout(function(){a.mediaWidthReset.call(a)},u)})})},t.DragDropFilter.prototype.update=function(t,e,s){this.bucketUpdate(t,e,s),this.rebuildResults(e),this.showMessage(i())},t.DragDropFilter.prototype.bucketUpdate=function(e,i,s){"out"===e&&void 0!==s&&this.bucketOrder.length>1&&(s.attr("data-filter")===this.bucketOrder[this.bucketOrder.length-1]?t(".in-bucket[data-filter="+this.bucketOrder[this.bucketOrder.length-2]+"]").children(".plus-icon").fadeOut(200,function(){t(this).remove()}):s.children(".plus-icon").remove()),"last-out"===i?(t(".bucket-instr").fadeIn(),t(".clear-all").hide().unbind("click")):"first-in"===i&&(t(".bucket-instr").hide(),t(".clear-all").fadeIn().bind("click",function(t){return function(){return t.clearAll.call(t),!1}}(this))),"undefined"!=typeof s&&this.positionInBucket(e,i,s),"out"===e&&void 0!==s&&this.bucketOrder.remove(s.text().toLowerCase()),this.bucketReact(i)},t.DragDropFilter.prototype.bucketReact=function(e){"last-out"===e?this.bucket.animate({height:"110px",top:"5px"},200).delay(20).animate({height:this.bucketHeightStart+"px",top:"0"},50,function(){t(this).css("height","auto")}):this.bucket.animate({height:"130px",top:"-5px"},100).delay(20).animate({height:"110px",top:"5px"},30).animate({height:"130px",top:"-5px"},100).delay(20).animate({height:"120px",top:"0"},50)},t.DragDropFilter.prototype.positionInBucket=function(e,i,s){var r,n=this,a=s.offset(),o=this.bucket.offset(),l=.5*s.width()+.5*n.settings.gutterWidth,h=o.top+this.settings.gutterWidth-a.top;if("in"===e){if("first-in"===i)r=.5*t(window).width()-.5*s.width()-a.left;else{var d=t(".in-bucket[data-filter="+this.bucketOrder[this.bucketOrder.length-2]+"]").offset().left,u=t(".in-bucket[data-filter="+this.bucketOrder[this.bucketOrder.length-2]+"]").width();r=d+u+this.settings.gutterWidth-l-a.left,t(".in-bucket").not(s).each(function(){t(this).animate({left:"-="+l+"px"},200)})}s.animate({top:"+="+h,left:"+="+r},200)}else if("last-out"!==i){var c;t.each(n.bucketOrder,function(e,i){s.attr("data-filter")===n.bucketOrder[n.bucketOrder.length-1]?c="+":s.attr("data-filter")===n.bucketOrder[0]?c="-":e<n.bucketOrder.getKeyByValue(s.attr("data-filter"))?c="+":e>n.bucketOrder.getKeyByValue(s.attr("data-filter"))&&(c="-"),t(".in-bucket[data-filter="+n.bucketOrder[e]+"]").animate({left:c+"="+l+"px"},200)})}},t.DragDropFilter.prototype.dropInBucket=function(e){if(e.hasClass("reverting")&&e.removeClass("reverting"),this.bucket.removeClass("over"),e.hasClass("in-bucket"))e.animate({top:this.curIconStartPos.top,left:this.curIconStartPos.left});else{var i=null;this.bucketOrder.push(e.text().toLowerCase()),0===t(".in-bucket").length?i="first-in":t('<span class="plus-icon">+</span>').appendTo(t(".in-bucket[data-filter="+this.bucketOrder[this.bucketOrder.length-2]+"]")).css("width",this.settings.gutterWidth+"px").hide().fadeIn(),e.addClass("in-bucket"),this.update("in",i,e),oldDropWidth=e.outerWidth()}},t.DragDropFilter.prototype.showMessage=function(e){t(".alert-message")&&t(".alert-message").remove(),t('<span class="alert-message alert">'+e+"</span>").insertAfter(this.bucket),$alertMessage=t(".alert-message"),clearTimeout(n),n=setTimeout(function(){$alertMessage.animate({opacity:0,height:0},400,function(){$alertMessage.remove()})},this.settings.alertSec)},t.DragDropFilter.prototype.clearAll=function(e){t(".in-bucket").each(function(){var e=t(this);e.animate({left:0,top:0},500).removeClass("in-bucket"),e.children(".plus-icon").remove()}),this.bucketOrder=[],"shaken"===e?this.showMessage("Not so fast, speed metal...they all fell out!"):this.showMessage("All filters cleared - showing all items!"),this.update("out","last-out")},t.DragDropFilter.prototype.rebuildResults=function(e,i){a.rebuildResultsPre(function(){"undefined"!=typeof a.resultsList&&a.resultsList.fadeOut("slow",function(){var i,s,n;i=t(".in-bucket");var o=t(a.resultsList).children("li");"last-out"===e?o.addClass("visible-result"):(o.removeClass("visible-result"),o.each(function(){s=t(this).attr("data-"+a.settings.filterGroup),"undefined"!=typeof s&&(n=s.split(" "),r(a.bucketOrder,n)?(t(this).hasClass("hidden-result")&&t(this).removeClass("hidden-result"),t(this).addClass("visible-result")):t(this).addClass("hidden-result"))})),a.resultsList.fadeIn()})})},t.DragDropFilter.prototype.mediaWidthReset=function(){var e,i;e=newWindowWidth<this.settings.narrowWidth?"auto":this.bucketHeightStart,t(".in-bucket").length>0&&(oldWindowWidth>this.settings.wideWidth&&newWindowWidth<this.settings.wideWidth||oldWindowWidth<this.settings.wideWidth&&newWindowWidth>this.settings.wideWidth||oldWindowWidth<this.settings.narrowWidth&&newWindowWidth>this.settings.narrowWidth||oldWindowWidth>this.settings.narrowWidth&&newWindowWidth<this.settings.narrowWidth)&&this.clearAll("shaken"),t(".in-bucket").each(function(){var e=(t(this).offset().left,oldWindowWidth-newWindowWidth),s=i-a.newParentPos,r=.5*e+.5*(oldDropWidth-newDropWidth)-s;t(this).animate({left:"-="+r})}),t(".in-bucket").length>0&&(oldDropWidth=t(".in-bucket:first-of-type").outerWidth()),i=t(".filter-option-slot:first-of-type").offset().left,oldWindowWidth=t(window).width()},Array.prototype.remove=function(t){this.splice(-1===this.indexOf(t)?this.length:this.indexOf(t),1)},Array.prototype.getKeyByValue=function(t){for(var e in this)if(this.hasOwnProperty(e)&&this[e]===t)return e}}(jQuery);
